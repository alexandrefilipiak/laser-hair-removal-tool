---
phase: 02-static-pages-seo
plan: 03
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - src/app/is-it-a-real-laser/[slug]/page.tsx
  - src/app/is-it-a-real-laser/[slug]/not-found.tsx
  - src/app/sitemap.ts
  - src/app/robots.ts
  - src/lib/schema.ts
autonomous: false

must_haves:
  truths:
    - "User can visit /is-it-a-real-laser/gentlemax-pro and see equipment details"
    - "Each page has unique meta title and description"
    - "JSON-LD Product schema visible in page source"
    - "sitemap.xml lists all equipment pages"
    - "robots.txt allows crawlers"
    - "Unknown slugs show 'ask your clinic' 404 page"
    - "Pages render correctly on mobile"
  artifacts:
    - path: "src/app/is-it-a-real-laser/[slug]/page.tsx"
      provides: "Dynamic equipment page with SSG"
      exports: ["generateStaticParams", "generateMetadata", "default"]
    - path: "src/app/is-it-a-real-laser/[slug]/not-found.tsx"
      provides: "Custom 404 for unknown equipment"
      exports: ["default"]
    - path: "src/app/sitemap.ts"
      provides: "Dynamic sitemap generation"
      exports: ["default"]
    - path: "src/app/robots.ts"
      provides: "robots.txt configuration"
      exports: ["default"]
    - path: "src/lib/schema.ts"
      provides: "JSON-LD schema generators"
      exports: ["generateProductSchema", "generateTechTermSchema"]
  key_links:
    - from: "src/app/is-it-a-real-laser/[slug]/page.tsx"
      to: "src/lib/equipment.ts"
      via: "data lookup"
      pattern: "getEquipmentBySlug"
    - from: "src/app/is-it-a-real-laser/[slug]/page.tsx"
      to: "src/components/EquipmentDetails.tsx"
      via: "component render"
      pattern: "EquipmentDetails|TechnologyTermDetails"
    - from: "src/app/sitemap.ts"
      to: "src/lib/equipment.ts"
      via: "slug enumeration"
      pattern: "getAllEquipmentSlugs"
---

<objective>
Create the dynamic [slug] route with static generation, SEO metadata, JSON-LD schema, sitemap, robots.txt, and 404 handling. Then verify the complete implementation.

Purpose: This ties together all Phase 2 work into functioning equipment pages that search engines can crawl and index. The checkpoint ensures quality before shipping.

Output: Fully functional equipment pages at /is-it-a-real-laser/[slug] with complete SEO infrastructure.
</objective>

<execution_context>
@C:/Users/alexa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/alexa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-static-pages-seo/02-RESEARCH.md

# Phase 1 data layer
@src/lib/equipment.ts
@src/data/equipment.json

# Phase 2 prior plans (components and layout)
# Read these for component APIs and patterns established
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create JSON-LD schema generators</name>
  <files>src/lib/schema.ts</files>
  <action>
Create src/lib/schema.ts with two schema generators:

generateProductSchema(machine: MachineEntry):
- @context: 'https://schema.org'
- @type: 'Product'
- name: machine.name
- description: machine.notes or fallback description
- brand: { @type: 'Brand', name: machine.manufacturer }
- manufacturer: { @type: 'Organization', name: machine.manufacturer }
- category: 'Medical Equipment > Laser Hair Removal'
- additionalProperty array with:
  - Technology Type: machine.technologyType
  - Wavelengths: machine.wavelengths.join(', ')
  - Brand Tier: machine.brandTier
  - Purpose: machine.purposeBuilt ? 'Purpose-built for hair removal' : 'Multi-purpose platform'

generateTechTermSchema(term: TechnologyTermEntry):
- @context: 'https://schema.org'
- @type: 'DefinedTerm' (more appropriate than Product for terms)
- name: term.name
- description: term.whatItIs
- inDefinedTermSet: 'Laser Hair Removal Technology Terms'

Import types from @/lib/equipment
Export both functions as named exports
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Schema generators produce valid JSON-LD objects for both entry types.</done>
</task>

<task type="auto">
  <name>Task 2: Create dynamic [slug] route with SSG and metadata</name>
  <files>src/app/is-it-a-real-laser/[slug]/page.tsx, src/app/is-it-a-real-laser/[slug]/not-found.tsx</files>
  <action>
Create src/app/is-it-a-real-laser/[slug]/page.tsx:

CRITICAL Next.js 15 patterns (from RESEARCH.md):
- params is a Promise - must await it
- Use `export const dynamicParams = false` to return 404 for unknown slugs

Structure:
```typescript
import { notFound } from 'next/navigation';
import type { Metadata } from 'next';
import { getEquipmentBySlug, getAllEquipmentSlugs, isMachine, isTechnologyTerm } from '@/lib/equipment';
import { EquipmentDetails } from '@/components/EquipmentDetails';
import { TechnologyTermDetails } from '@/components/TechnologyTermDetails';
import { JsonLd } from '@/components/JsonLd';
import { generateProductSchema, generateTechTermSchema } from '@/lib/schema';

export const dynamicParams = false;

export async function generateStaticParams() {
  const slugs = getAllEquipmentSlugs();
  return slugs.map((slug) => ({ slug }));
}

export async function generateMetadata({
  params,
}: {
  params: Promise<{ slug: string }>;
}): Promise<Metadata> {
  const { slug } = await params;
  const equipment = getEquipmentBySlug(slug);

  if (!equipment) {
    return { title: 'Equipment Not Found' };
  }

  // Different metadata for machines vs technology terms
  if (isMachine(equipment)) {
    const isRealLaser = equipment.technologyType === 'laser';
    const classification = isRealLaser ? 'Real Laser' : 'Not a Laser';
    return {
      title: `${equipment.name} - ${classification}`,
      description: `Is ${equipment.name} by ${equipment.manufacturer} a real laser? ${classification}. Brand tier: ${equipment.brandTier}. ${equipment.notes || ''}`.slice(0, 160),
      openGraph: {
        title: `${equipment.name} - ${classification}`,
        description: `${equipment.manufacturer} ${equipment.name}: ${classification}`,
      },
    };
  }

  // Technology term
  return {
    title: `${equipment.name} - Is it a Real Laser?`,
    description: equipment.whatItIs.slice(0, 160),
  };
}

export default async function EquipmentPage({
  params,
}: {
  params: Promise<{ slug: string }>;
}) {
  const { slug } = await params;
  const equipment = getEquipmentBySlug(slug);

  if (!equipment) {
    notFound();
  }

  if (isMachine(equipment)) {
    return (
      <>
        <JsonLd data={generateProductSchema(equipment)} />
        <EquipmentDetails equipment={equipment} />
      </>
    );
  }

  return (
    <>
      <JsonLd data={generateTechTermSchema(equipment)} />
      <TechnologyTermDetails term={equipment} />
    </>
  );
}
```

Create src/app/is-it-a-real-laser/[slug]/not-found.tsx:
- Custom 404 page per RESEARCH.md pattern
- "Equipment Not Found" heading
- "Ask your clinic what brand and model they use" guidance
- Helpful content: "Reputable clinics will tell you the exact equipment brand"
- Link back to homepage
- Mobile-responsive with Tailwind
  </action>
  <verify>
Run `npm run dev` and visit:
- http://localhost:3000/is-it-a-real-laser/gentlemax-pro (should render)
- http://localhost:3000/is-it-a-real-laser/shr (technology term)
- http://localhost:3000/is-it-a-real-laser/unknown-machine (should 404)
View page source - should see JSON-LD script tag
  </verify>
  <done>Equipment pages render at /is-it-a-real-laser/[slug]. Unknown slugs show custom 404. JSON-LD visible in page source.</done>
</task>

<task type="auto">
  <name>Task 3: Create sitemap and robots.txt</name>
  <files>src/app/sitemap.ts, src/app/robots.ts</files>
  <action>
Create src/app/sitemap.ts:
```typescript
import type { MetadataRoute } from 'next';
import { getAllEquipmentSlugs } from '@/lib/equipment';

const BASE_URL = 'https://laserhairremovalmap.com';

export default function sitemap(): MetadataRoute.Sitemap {
  const slugs = getAllEquipmentSlugs();

  const equipmentPages = slugs.map((slug) => ({
    url: `${BASE_URL}/is-it-a-real-laser/${slug}`,
    lastModified: new Date(),
    changeFrequency: 'monthly' as const,
    priority: 0.8,
  }));

  return [
    {
      url: BASE_URL,
      lastModified: new Date(),
      changeFrequency: 'weekly' as const,
      priority: 1,
    },
    {
      url: `${BASE_URL}/is-it-a-real-laser`,
      lastModified: new Date(),
      changeFrequency: 'weekly' as const,
      priority: 0.9,
    },
    ...equipmentPages,
  ];
}
```

Create src/app/robots.ts:
```typescript
import type { MetadataRoute } from 'next';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
    },
    sitemap: 'https://laserhairremovalmap.com/sitemap.xml',
  };
}
```

Note: BASE_URL is hardcoded per RESEARCH.md recommendation. Can switch to env var later if needed.
  </action>
  <verify>
Run `npm run dev` and visit:
- http://localhost:3000/sitemap.xml (should list all equipment)
- http://localhost:3000/robots.txt (should show allow: / and sitemap URL)
  </verify>
  <done>sitemap.xml lists all equipment pages. robots.txt allows crawlers and references sitemap.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify complete implementation</name>
  <what-built>
Complete static pages with SEO infrastructure:
- Dynamic equipment pages at /is-it-a-real-laser/[slug]
- Machine pages with classification, brand tier, skin types, disclaimer
- Technology term pages with clarification content
- JSON-LD schema markup on all pages
- sitemap.xml with all equipment URLs
- robots.txt for crawler access
- Custom 404 with "ask your clinic" messaging
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`

2. Check machine page:
   - Visit http://localhost:3000/is-it-a-real-laser/gentlemax-pro
   - Verify: "Real Laser" badge visible and green
   - Verify: Brand tier shows "Gold Standard"
   - Verify: Manufacturer, wavelengths, skin types displayed
   - Verify: Disclaimer at bottom
   - View page source: search for "application/ld+json" - should contain Product schema

3. Check technology term page:
   - Visit http://localhost:3000/is-it-a-real-laser/shr
   - Verify: Classification shows "Ask Your Clinic" (yellow)
   - Verify: "What It Is" and "Why It Matters" sections visible
   - View page source: search for "DefinedTerm" in JSON-LD

4. Check 404 page:
   - Visit http://localhost:3000/is-it-a-real-laser/unknown-machine
   - Verify: Custom 404 with "ask your clinic" guidance (not generic Next.js 404)

5. Check SEO infrastructure:
   - Visit http://localhost:3000/sitemap.xml
   - Verify: Contains /is-it-a-real-laser/gentlemax-pro and other equipment URLs
   - Visit http://localhost:3000/robots.txt
   - Verify: Shows "Allow: /" and sitemap URL

6. Check mobile responsiveness:
   - Open DevTools, toggle device toolbar (Ctrl+Shift+M)
   - Check iPhone SE (375px width)
   - Verify: Content readable, no horizontal scroll, badges visible

7. Build test:
   - Run `npm run build`
   - Verify: Build completes without errors
   - Verify: Output shows static pages generated for all equipment slugs
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass.
If issues found, describe what's wrong and I'll fix it.
  </resume-signal>
</task>

</tasks>

<verification>
1. Equipment pages render at correct URLs
2. Classification displays correctly (Real Laser / Not a Laser / Ask Your Clinic)
3. Brand tier, purpose, skin types all visible
4. Disclaimer appears on every page
5. JSON-LD schema in page source
6. sitemap.xml lists all equipment
7. robots.txt allows crawlers
8. Unknown slugs show helpful 404
9. Mobile layout works (no horizontal scroll)
10. Build succeeds with static export
</verification>

<success_criteria>
- All 8 Phase 2 success criteria from ROADMAP met:
  1. User can visit /is-it-a-real-laser/[slug] for any equipment entry and see its classification
  2. Each machine page displays clear "Real Laser" or "Not a Laser" classification prominently
  3. Each machine page shows brand tier, purpose-built/multi-purpose distinction
  4. Permanent disclaimer appears on every result page
  5. Each page has unique meta title, description, and JSON-LD Product schema visible to crawlers
  6. sitemap.xml lists all machine pages and robots.txt allows crawler access
  7. Pages render correctly on mobile devices (responsive layout)
  8. Unknown brand searches show "ask your clinic what brand" messaging
</success_criteria>

<output>
After completion, create `.planning/phases/02-static-pages-seo/02-03-SUMMARY.md`
</output>
